<!-- This file is generated by system. Do not edit this file. -->
<script name="Delete_UnProtected_BVLAN">
<comments>This scripts deletes a list of unprotected 802.1ah B-VLANs after removing them from Ports</comments>
<content># @METADATASTART
#@DetailDescriptionStart
#############################################################################
# Extreme Networks(R) CLI Scripting Library
# scripting.Script        : Unprotected B-VLANs deletion after removing from Ports
#############################################################################
# Revision      : 1.0
# Last Updated  : 26-DEC-2009
#############################################################################
# Author Name   : NMS Team
#############################################################################
# Purpose:
#############################################################################
# 1. Delete the list of Non-Ring Ports from each B-VLAN in the List.
# 2. Delete the list of B-VLAN(s).
#############################################################################
#@DetailDescriptionEnd

# @ScriptDescription &quot;This script deletes 802.1ah B-VLANs after removing from Ports&quot;
# @SectionStart (description = &quot;Unprotected B-VLAN Deletion Parameters&quot;)

# @VariableFieldLabel (description = &quot;Abort on error?&quot;,
#   type        = String,
#   scope       = global,
#   required    = yes,
#   validValues = [yes,no])
set var abortOnCliError yes

################################################################################
# B-VLAN Definition
################################################################################
# @VariableFieldLabel (description = &quot;Comma separated List of B-VLAN Names&quot;
#   type        = String,
#   scope       = global,
#   required    = yes)
set var unprotBVLanNameSeq &quot;&quot;

# @VariableFieldLabel (description = &quot;Comma separated List of B-VLAN Ports&quot;
#   type        = String,
#   scope       = device,
#   required    = yes)
set var unprotBVLanPortSeq &quot;&quot;

# @SectionEnd
# @MetaDataEnd

################################################################################
################################################################################
# CONFIGURATION DETAIL
################################################################################

############################################################################
# TCL Procedure for CLI scripting.Script Execution Mode setting
############################################################################
proc setCliErrorHandling {inAbortStatus} {

     global abort_on_error

     if {![string compare $inAbortStatus "yes"]} {
        configure cli mode scripting abort-on-error
     } else {
        configure cli mode scripting ignore-error
     }
}

proc validateVendorName {inVendorName} {

    global abort_on_error

    IF (![string equal $inVendorName &quot;Extreme&quot;]) THEN
       error &quot;This script is only supported for Extreme switches.&quot;
    ENDIF
}

################################################################################
# Setup B-VLAN Deletion Parameters Validations
################################################################################
proc validateBVLanDeleteParams {inBVLanNameSeq inBVLanPortSeq} {

    global abort_on_error

    IF (![expr [string length $inBVLanNameSeq] &gt; 0]) THEN
       error &quot;FAILED: B-VLAN Name List empty.&quot;
    ENDIF

    IF (![expr [string length $inBVLanPortSeq] &gt; 0]) THEN
       error &quot;FAILED: B-VLAN Port List empty.&quot;
    ENDIF
}

###########################################################################
# TCL Procedure to removal Ports from the B-VLAN
###########################################################################
proc delPortsFromOneBVLan {inBVLanName inBVLanPortSeq} {

    global abort_on_error

    if {[catch {
       config bvlan $inBVLanName delete ports $inBVLanPortSeq
    } result]} {
       error &quot;FAILED: Could not delete Ports $inBVLanPortSeq from BVLan $inBVLanName, $result&quot;
    }
}

proc delOneBVLan {inBVLanName} {

    global abort_on_error

    if {[catch {
       delete bvlan $inBVLanName
    } result]} {
       error &quot;FAILED: Could not delete BVLan $inBVLanName, $result&quot;
    }
}

proc delPortsFromAllBVLans {inBVLanNameList inBVLanPortSeq} {

    global abort_on_error

    foreach currBVLanName $inBVLanNameList {
       delPortsFromOneBVLan $currBVLanName $inBVLanPortSeq
    }
}

proc delAllBVLans {inBVLanNameList} {

    global abort_on_error

    foreach currBVLanName $inBVLanNameList {
       delOneBVLan $currBVLanName
    }
}

#########################################################################
# TCL Procedure to remove Ports from B-VLANs and also delete the B-VLANs
#########################################################################
proc delete8021ahBVLans {inBVLanNameSeq
                         inBVLanPortSeq} {
    global abort_on_error

    set tmpBVLanNameList [split $inBVLanNameSeq ,]

    delPortsFromAllBVLans $tmpBVLanNameList $inBVLanPortSeq

    delAllBVLans $tmpBVLanNameList
}

#########################################################################
# TCL Procedure to validate a List of B-VLANs and also delete the B-VLANs
#########################################################################
proc deleteUnProtBVLans {inBVLanNameSeq
                         inBVLanPortSeq} {
    global abort_on_error
    global isExos

	if {[string match $isExos true]} {
    	create log entry &quot;Starting Unprotected B-VLAN Deletion on Switch&quot;
	}

    validateBVLanDeleteParams $inBVLanNameSeq \
                              $inBVLanPortSeq

    delete8021ahBVLans $inBVLanNameSeq \
                       $inBVLanPortSeq

	if {[string match $isExos true]} {
    	create log entry &quot;Finished Unprotected B-VLAN Deletion on Switch&quot;
	}
}

################################################################################
# CLI MODE Settings
################################################################################
setCliErrorHandling $abortOnCliError

validateVendorName $vendor

deleteUnProtBVLans $unprotBVLanNameSeq \
                   $unprotBVLanPortSeq

#################################################################################
## Now Sync B-VLAN and Topology on this device so that they are shown in the Client
#################################################################################
PerformSync -device $deviceIP -scope PBB
</content>
<contexts></contexts>
<supprotedGroups></supprotedGroups>
<roles>,Administrator,</roles>
<auditLogEnabled>false</auditLogEnabled>
<saveConfigOnExit>true</saveConfigOnExit>
<menuScope>TOOLS</menuScope>
<scriptTimeout>120</scriptTimeout>
<defaultCategory>Provisioning</defaultCategory>
<creator>system</creator>
<scriptOwner>system</scriptOwner>

</script>
