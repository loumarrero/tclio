<!-- This file is generated by system. Do not edit this file. -->
<script name="Disable_VLAN_Service_Port">
<comments>This script disables a 802.1Q VLAN Service</comments>
<content>#@MetaDataStart
#@DetailDescriptionStart
#############################################################################
# Extreme Networks(R) CLI Scripting Library
# scripting.Script        : Disables a 802.1Q VLAN Service for Customer
#############################################################################
# Revision      : 1.0
# Last Updated  : 26-DEC-2009
#############################################################################
# Author Name   : NMS Team
#############################################################################
# Purpose:  This script disables a 802.1Q VLAN based Service
#############################################################################
#@DetailDescriptionEnd

# @ScriptDescription &quot;scripting.Script to disable a 802.1Q VLAN&quot;
# @SectionStart (description = &quot;VLAN&quot;)

# @VariableFieldLabel ( description = &quot;Abort on error?&quot;,
#   type        = String,
#   scope       = global,
#   required    = yes,
#   validValues = [yes,no])
set var abortOnCliError yes

# @VariableFieldLabel ( description = &quot;VLAN Name&quot;,
#   type        = VLAN_NAME,
#   scope       = global,
#   required    = yes,
#   readonly    = no
#  )
set var ethServVLanName &quot;&quot;

# @VariableFieldLabel (description = &quot;Comma Listed EAPS Domain Names&quot;
#   type        = String,
#   scope       = global,
#   required    = no)
set var ethServEapsDomainNameSeq &quot;&quot;

# @SectionEnd
# @MetaDataEnd
################################################################################
################################################################################
#                    CONFIGURATION DETAIL
################################################################################
################################################################################

############################################################################
# TCL Procedure for CLI scripting.Script Execution Mode setting
############################################################################
proc setCliErrorHandling {inAbortStatus} {

     global abort_on_error

     if {![string compare $inAbortStatus "yes"]} {
        configure cli mode scripting abort-on-error
     } else {
        configure cli mode scripting ignore-error
     }
}

############################################################################
# Define TCL Procedures for Service Parameter Validation
############################################################################
proc validateVLanServiceParams {inVLanName} {

    global abort_on_error
    global vendor

    IF (![string equal $vendor &quot;Extreme&quot;]) THEN
       error &quot;This script is only supported for Extreme switches.&quot;
    ENDIF

    IF (![expr [string length $inVLanName] &gt; 0]) THEN
       error &quot;VLAN name can not be empty.&quot;
    ENDIF
}

############################################################################
# TCL Procedure to disable a 802.1Q VLAN Service
############################################################################
proc disableVLanService {inVLanName} {

    global abort_on_error

    if {[catch {
       disable vlan $inVLanName
    } result]} {
       error &quot;FAILED: Cannot disable VLAN $inVLanName, $result&quot;
    }
}

############################################################################
# TCL Procedure to remove EAPS Protection of the VLAN
############################################################################
proc remProtectVLanFromOneDomain {inVLanName inDomainName} {

    global abort_on_error

    if {[catch {
        config eaps $inDomainName delete protected $inVLanName
		regexp {.*WARNING: Make sure EAPS ring-ports are deleted from the VLAN first.*} ${CLI.OUT} foundit
        if {[info exists foundit]} {
           CLI Yes
        }  
    } errMsgText]} {
        puts &quot;FAILED: Cannot delete protection of VLAN $inVLanName from EAPS-Domain $inDomainName, $errMsgText&quot;
    }
}

proc remProtectVLanFromAllDomain {inVLanName inDomainNameList} {

    if {[llength $inDomainNameList] == 0} {
       return
    }

    foreach currDomainName $inDomainNameList {
       remProtectVLanFromOneDomain $inVLanName $currDomainName
    }
}

############################################################################
# TCL Procedure to disable a 802.1Q VLAN based Service
############################################################################
proc disableDot1qVLanService {inVLanName inDomainNameSeq} {

    global abort_on_error
	global isExos

	if {[string match $isExos true]} {
    	create log entry &quot;Starting 802.1q VLAN Service disabling on Switch&quot;
	}

    set tmpDomainNameList [split $inDomainNameSeq ,]

    validateVLanServiceParams   $inVLanName
    remProtectVLanFromAllDomain $inVLanName $tmpDomainNameList
    disableVLanService          $inVLanName

    if {[string match $isExos true]} {
    	create log entry &quot;Finished 802.1q VLAN Service disabling on Switch&quot;
	}
}

################################################################################
# CLI MODE
################################################################################
setCliErrorHandling $abortOnCliError

disableDot1qVLanService $ethServVLanName $ethServEapsDomainNameSeq

PerformSync -device $deviceIP -scope VLAN -vlan $ethServVLanName
PerformSync -device $deviceIP -scope EapsDomain -type protected -name $ethServEapsDomainNameSeq</content>
<contexts></contexts>
<supprotedGroups></supprotedGroups>
<roles>,Administrator,</roles>
<auditLogEnabled>false</auditLogEnabled>
<saveConfigOnExit>true</saveConfigOnExit>
<menuScope>TOOLS</menuScope>
<scriptTimeout>120</scriptTimeout>
<defaultCategory>Provisioning</defaultCategory>
<creator>system</creator>
<scriptOwner>system</scriptOwner>
</script>
