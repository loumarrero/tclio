<!-- This file is generated by system. Do not edit this file. -->
<script name="Rollback_CRE_EAPSDomain_ControlVLAN">
<comments>This script rollsback previously created control VLAN and EAPS Domain</comments>
<content>#@METADATASTART
#@DetailDescriptionStart
#############################################################################
# Extreme Networks(R) CLI Scripting Library
# scripting.Script        : Rollback of EAPS Domain and Control Vlan Creation
#############################################################################
# Revision      : 1.0
# Last Updated  : 07-JAN-2010
#############################################################################
# Author Name   : NMS Team
#############################################################################
# Purpose:
#############################################################################
# 1.  Create Tagged control VLAN
# 2.  Assign the control VLAN to a QoS Profile
# 3.  Create EAPS domain
# 3.  Add the control VLAN to a EAPS domain
# 4.  Enable EAPS domain
#####################################################################
#@DetailDescriptionEnd

# @ScriptDescription &quot;Rollsback created EAPS Domain and Control VLAN&quot;
# @SectionStart (description = &quot;EAPS-Domain Create-Rollback Params&quot;)

# @VariableFieldLabel (description = &quot;Abort on error?&quot;,
#   type        = String,
#   scope       = global,
#   required    = yes,
#   validValues = [yes,no])
set var abortOnCliError yes

################################################################################
# EAPS Definition
################################################################################

# @VariableFieldLabel (description = &quot;EAPS Domain Name&quot;,
#     type        = String,
#     scope       = global,
#     required    = yes)
set var eapsDMDomainName &quot;&quot;

# @VariableFieldLabel (description = &quot;EAPS Fail Time, 2-300 Seconds&quot;
#     type          = String,
#     scope         = global,
#     required      = yes)
set var eapsDMFailTime 2

# @VariableFieldLabel (description = &quot;EAPS Hello Time, 0-15 Seconds&quot;
#     type          = String,
#     scope         = global,
#     required      = yes)
set var eapsDMHelloTimeSec 0

# @VariableFieldLabel (description = &quot;EAPS Hello Time, 0-999 Ms, Min 100&quot;
#     type          = String,
#     scope         = global,
#     required      = yes)
set var eapsDMHelloTimeMSec 100

# @VariableFieldLabel (description = &quot;EAPS Control VLAN Name&quot;,
#     type        = VLAN_NAME,
#     scope       = global,
#     required    = yes)
set var eapsDMControlVLanName &quot;&quot;

# @VariableFieldLabel (description = &quot;EAPS Control VLAN Tag&quot;,
#     type        = String,
#     scope       = global,
#     required    = yes)
set var eapsDMControlVLanTag &quot;&quot;

# @VariableFieldLabel (description = &quot;EAPS Control VLAN QoS Profile&quot;
#     type         = String,
#     scope        = global,
#     required     = yes,
#     readonly     = yes)
set var eapsDMControlVLanQPNum 8

# @VariableFieldLabel (description = &quot;EAPS Node Primary Port&quot;
#     type        = String,
#     scope       = device,
#     required    = yes)
set var eapsDMPrimaryPort  &quot;&quot;

# @VariableFieldLabel (description = &quot;EAPS Node Secondary Port&quot;
#     type        = String,
#     scope       = device,
#     required    = yes)
set var eapsDMSecondaryPort  &quot;&quot;

# @VariableFieldLabel (description = &quot;EAPS Node Role&quot;
#     type        = String,
#     scope       = device,
#     required    = yes,
#     validValues = [master,transit])
set var eapsDMNodeRole transit

# @SectionEnd
# @MetaDataEnd

###########################################################################
# CONFIGURATION DETAIL
###########################################################################

############################################################################
# TCL Procedure for CLI scripting.Script Execution Mode setting
############################################################################
proc setCliErrorHandling {inAbortStatus} {

     if {![string compare $inAbortStatus "yes"]} {
        configure cli mode scripting abort-on-error
     } else {
        configure cli mode scripting ignore-error
     }
}

#####################################################################
# TCL Procedure for EAPS Domain Parameter Validation
#####################################################################
proc validateEapsDomainParams {inDomainName
                               inCtrlVLanName} {
    global vendor

    IF (![string equal $vendor &quot;Extreme&quot;]) THEN
       error &quot;This script is only supported for Extreme switches.&quot;
    ENDIF
    
    IF (![expr [string length $inDomainName] &gt; 0]) THEN
       error &quot;FAILED: EAPS Domain Name is empty.&quot;
    ENDIF
    
    IF (![expr [string length $inCtrlVLanName] &gt; 0]) THEN
       error &quot;FAILED: Control VLAN Name is empty.&quot;
    ENDIF
}

############################################################################
# TCL Procedure for EAPS Domain and Control-VLAN Deletion
############################################################################
proc deleteEapsDomainCtrlVLan {inDomainName
                               inCtrlVLanName} {
    if {[catch {
       disable eaps $inDomainName
    } errMsgText ]} { 
       puts &quot;FAILED: Cannot disable EAPS Domain $inDomainName $errMsgText&quot;
    }

    if {[catch {
       delete vlan $inCtrlVLanName
    } errMsgText ]} { 
       puts &quot;FAILED: Cannot delete Control VLAN $inVLanName $errMsgText&quot;
    }

    if {[catch {
       delete eaps $inDomainName
    } errMsgText ]} { 
       puts &quot;FAILED: Cannot delete EAPS Domain $inDomainName $errMsgText&quot;
    }
}

##################################################################
# TCL Procedure for EAPS Domain and Control VLAN Creation
# after validating all parameters
##################################################################
proc rollbackEapsDomainCtrlVLanCreate {inDomainName
                                       inNodeRole
                                       inFailTime
                                       inHelloSec
                                       inHelloMSec
                                       inPrimaryPort
                                       inSecondaryPort
                                       inCtrlVLanName
                                       inCtrlVLanTag
                                       inCtrlVLanQPNum} {

	global isExos
	
	if {[string match $isExos true]} {
    	create log entry &quot;START-Create-Rollback EAPS Domain and Control VLAN&quot;
	}
	
    validateEapsDomainParams $inDomainName \
                             $inCtrlVLanName

    deleteEapsDomainCtrlVLan $inDomainName \
                             $inCtrlVLanName

	if {[string match $isExos true]} {
    	create log entry &quot;FINISH-Create-Rollback EAPS Domain and Control VLAN&quot;
	}
}

############################################################################
# CLI Configuration Starting on the Switch
############################################################################
setCliErrorHandling $abortOnCliError

rollbackEapsDomainCtrlVLanCreate $eapsDMDomainName \
                                 $eapsDMNodeRole \
                                 $eapsDMFailTime \
                                 $eapsDMHelloTimeSec \
                                 $eapsDMHelloTimeMSec \
                                 $eapsDMPrimaryPort \
                                 $eapsDMSecondaryPort \
                                 $eapsDMControlVLanName \
                                 $eapsDMControlVLanTag \
                                 $eapsDMControlVLanQPNum
</content>
<contexts></contexts>
<supprotedGroups>,ALL,</supprotedGroups>
<roles>,Administrator,</roles>
<auditLogEnabled>false</auditLogEnabled>
<scriptTimeout>120</scriptTimeout>
<defaultCategory>Provisioning</defaultCategory>
<creator>system</creator>
<scriptOwner>system</scriptOwner>

</script>
