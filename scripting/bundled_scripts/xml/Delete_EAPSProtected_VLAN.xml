<!-- This file is generated by system. Do not edit this file. -->
<script name="Delete_EAPSProtected_VLAN">
<comments>This scripts deletes a list of VLANs after removing them from EAPS domain protection</comments>
<content># @METADATASTART
#@DetailDescriptionStart
#############################################################################
# Extreme Networks(R) CLI Scripting Library
# scripting.Script        : VLAN deletion after removing from EAPS domain's protection
#############################################################################
# Revision      : 1.0
# Last Updated  : 26-DEC-2009
#############################################################################
# Author Name   : NMS Team
#############################################################################
# Purpose:
#############################################################################
# 1. Delete the list of VLAN from protection of a list of EAPS domains.
# 1. Delete the list of Ring Ports from each VLAN in the List.
# 2. Delete the list of VLAN(s).
#############################################################################
#@DetailDescriptionEnd

# @ScriptDescription &quot;This script deletes VLANs after removing from EAPS domain's protection&quot;
# @SectionStart (description = &quot;VLAN Protection Parameters&quot;)

# @VariableFieldLabel (description = &quot;Abort on error?&quot;,
#   type        = String,
#   scope       = global,
#   required    = yes,
#   validValues = [yes,no])
set var abortOnCliError yes

################################################################################
# VLAN Definition
################################################################################

# @VariableFieldLabel (description = &quot;List of comma separated VLAN Names&quot;,
#   type        = String,
#   scope       = global,
#   required    = yes)
set var eapsProtVLanNameSeq &quot;&quot;

# @VariableFieldLabel (description = &quot;List of comma separated EAPS Domain Names&quot;
#   type        = String,
#   scope       = global,
#   required    = yes)
set var eapsProtDomainNameSeq &quot;&quot;

# @VariableFieldLabel (description = &quot;List of comma separated protecting Ring Ports&quot;
#   type        = String,
#   scope       = device,
#   required    = yes)
set var eapsProtRingPortSeq &quot;&quot;

# @SectionEnd
# @MetaDataEnd

############################################################################
# TCL Procedure for CLI scripting.Script Execution Mode setting
############################################################################
proc setCliErrorHandling {inAbortStatus} {

     global abort_on_error

     if {![string compare $inAbortStatus "yes"]} {
        configure cli mode scripting abort-on-error
     } else {
        configure cli mode scripting ignore-error
     }
}

############################################################################
# TCL Procedure for VLAN Protection Parameter Validation
############################################################################
proc validateVLanProtectParams {inVLanNameSeq inDomainNameSeq inRingPortSeq} {

    global abort_on_error
    global vendor

    IF (![string equal $vendor &quot;Extreme&quot;]) THEN
       error &quot;This script is only supported for Extreme switches.&quot;
    ENDIF
    
    IF (![expr [string length $inVLanNameSeq] &gt; 0]) THEN
       error &quot;FAILED: VLAN Name List is empty.&quot;
    ENDIF
    
    IF (![expr [string length $inDomainNameSeq] &gt; 0]) THEN
       error &quot;FAILED: EAPS Domain Name List is empty.&quot;
    ENDIF
    
    IF (![expr [string length $inRingPortSeq] &gt; 0]) THEN
       error &quot;FAILED: VLAN Protect Port List is empty.&quot;
    ENDIF
}

#################################################################################
# Define TCL procedures for VLAN removal from EAPS Domain Ring Ports
# and subsequent deletion of the VLAN
################################################################################
proc remProtectOneVLanFromOneDomain {inVLanName inDomainName} {

    global abort_on_error

    if {[catch {
        config eaps $inDomainName delete protected $inVLanName
    } errMsgText]} { 
        puts &quot;FAILED: Cannot delete protection of VLAN $inVLanName from EAPS-Domain $inDomainName, $errMsgText&quot;
    }
}

proc remProtectOneVLanFromAllDomain {inVLanName inDomainNameList} {

    global abort_on_error

    foreach currDomainName $inDomainNameList {
       remProtectOneVLanFromOneDomain $inVLanName $currDomainName
    }
}

proc delPortsFromOneVLan {inVLanName inRingPortSeq} {

    global abort_on_error

    if {[catch {
       config vlan $inVLanName delete ports $inRingPortSeq
    } errMsgText]} { 
       puts &quot;FAILED: Could not delete Ports $inRingPortSeq from VLAN $inVLanName, $errMsgText&quot;
    }
}

proc delOneVLan {inVLanName} {

    global abort_on_error

    if {[catch {
       delete vlan $inVLanName
    } errMsgText]} { 
       puts &quot;FAILED: Could not delete VLAN $inVLanName, $errMsgText&quot;
    }
}

proc remProtectAllVLanFromAllDomain {inVLanNameList inDomainNameList} {

    global abort_on_error

    foreach currVLanName $inVLanNameList {
       remProtectOneVLanFromAllDomain $currVLanName $inDomainNameList
    }
}

proc delPortsFromAllVLan {inVLanNameList inRingPortSeq} {

    global abort_on_error

    foreach currVLanName $inVLanNameList {
       delPortsFromOneVLan $currVLanName $inRingPortSeq
    }
}

proc delAllVLan {inVLanNameList} {

    global abort_on_error

    foreach currVLanName $inVLanNameList {
       delOneVLan $currVLanName
    }
}

######################################################################
# TCL Procedure for VLAN deletion after protection removal from
# EAPS Domain after validating all parameters
######################################################################
proc handleProtectedVLanDelete {inVLanNameSeq
                                inDomainNameSeq
                                inRingPortSeq} {
    global abort_on_error
    global isExos

	if {[string match $isExos true]} {
    	create log entry &quot;Starting VLAN protection removal from EAPS on Switch&quot;
   	}

    validateVLanProtectParams $inVLanNameSeq \
                              $inDomainNameSeq \
                              $inRingPortSeq

    set tmpVLanNameList   [split $inVLanNameSeq ,]
    set tmpDomainNameList [split $inDomainNameSeq ,]
    
    remProtectAllVLanFromAllDomain $tmpVLanNameList \
                                   $tmpDomainNameList
    
    delPortsFromAllVLan $tmpVLanNameList \
                        $inRingPortSeq
    
    delAllVLan $tmpVLanNameList

	if {[string match $isExos true]} {
    	create log entry &quot;Finished VLAN protection removal from EAPS on Switch&quot;
   	}
}

##############################################################
# CLI Configuration Starting
##############################################################
setCliErrorHandling $abortOnCliError

handleProtectedVLanDelete $eapsProtVLanNameSeq \
                          $eapsProtDomainNameSeq \
                          $eapsProtRingPortSeq

#######################################################################
## Sync VLAN and Topology on this Device
########################################################################
PerformSync -device $deviceIP -scope EapsDomain -type protected -name $eapsProtDomainNameSeq
PerformSync -device $deviceIP -scope VLAN
</content>
<contexts></contexts>
<supprotedGroups></supprotedGroups>
<roles>,Administrator,</roles>
<auditLogEnabled>false</auditLogEnabled>
<saveConfigOnExit>true</saveConfigOnExit>
<menuScope>TOOLS</menuScope>
<scriptTimeout>120</scriptTimeout>
<defaultCategory>Provisioning</defaultCategory>
<creator>system</creator>
<scriptOwner>system</scriptOwner>

</script>
