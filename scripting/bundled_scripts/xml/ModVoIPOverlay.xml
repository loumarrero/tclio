<!-- This file is generated by system. Do not edit this file. -->
<script name="ModVoIPOverlay">
  <comments>The script assists in the configuration of various switch parameters for a new
edge switch. The script can also be manually loaded onto a switch and run.</comments>
 <content>
enable cli scripting
create log entry "VoIP Overlay scripting.Script Started On Switch"
# @METADATASTART
#@DetailDescriptionStart
################################################################################
# Extreme Networks(R) CLI Scripting Library
#
# scripting.Script        : VoIP Application Overlay scripting.Script
# Revision      : 2.0
# Last Updated  : October 29, 2007
#
# Purpose:  Setup of network parameters needed to support VoIP services on
#           Extreme Networks edge switches.
#
#   1.  Create a VLAN for voice traffic if needed
#   2.  Configure and enable LLDP
#   3.  Create and configure necessary QoS queues
#   4.  Enable DiffServ
#   5.  Assign DiffServ Code Points (DSCP) to a QoS queue
#
#
################################################################################
#@DetailDescriptionEnd
# @ScriptDescription "Configure network parameters to support VoIP services."
# @SeparatorLine
# @VariableFieldLabel "If this script encounters errors, do you wish to abort or ignore?"
set var ynCliModeAbortIgnore abort
# @SeparatorLine

################################################################################
# @SeparatorLine
################################################################################
# Part Of Stack?
################################################################################
# @VariableFieldLabel "Is this switch part of an SummitStack(TM)? (yes or no)"
set var ynstack yes
# @SeparatorLine
################################################################################
# VLAN Configuration  Variable Definitions
################################################################################
# @VariableFieldLabel "Create a new VLAN for Voice traffic? (yes or no)"
set var ynvvoice no
# @VariableFieldLabel "Name of voice VLAN"
set var vvoice voice
# @VariableFieldLabel "Voice VLAN tag"
set var vvoicetag 200
# @VariableFieldLabel "Add Ports to Voice VLAN? (Select no if using Universal Port)"
set var ynvvoiceports yes
# @VariableFieldLabel "Voice VLAN device ports. (Uplinks need to be manually configured)"
set var vvoiceports 22,23
# @VariableFieldLabel "Tag Ports on Voice VLAN?"
set var ynvvoicetag no
# @VariableFieldLabel "Remove ports from previous VLAN? (Required if ports are members of another VLAN as untagged)"
set var ynvremove yes
# @VariableFieldLabel "Name of VLAN to remove untagged ports from. (Required if ports are members of another VLAN as untagged)"
set var vremove default
# @SeparatorLine
################################################################################
# LLDP (802.1ab) Configuration Variable Definitions
################################################################################
# @VariableFieldLabel "Enable LLDP (802.1ab) on Voice ports?"
set var ynlldp yes
# @VariableFieldLabel "Send Extreme-Avaya LLDP values? (yes or no)"
set var ynlldpavaya yes
# @VariableFieldLabel "Avaya File Server Address?"
set var lldpavayafile 192.168.20.200
# @VariableFieldLabel "Avaya Call Server IP Address?"
set var lldpavayacall 192.168.20.30
# @SeparatorLine
################################################################################
# QoS and DiffServ Variable Definitions
################################################################################
# @VariableFieldLabel "Setup QoS and DiffServ mapping for voice? (yes or no)"
set var yndiffserv yes
# @VariableFieldLabel "Create QoS queues? (yes or no)"
set var ynqosqueue no
# @VariableFieldLabel "Voice Application DSCP value"
set var voicedscp 46
# @SeparatorLine
# @MetaDataEnd

################################################################################
################################################################################
#    CONFIGURATION DETAIL
################################################################################
################################################################################

################################################################################
# Voice VLAN Creation
################################################################################
if (!$match($ynvvoice,yes)) then
  create vlan $vvoice
  config vlan $vvoice tag $vvoicetag
  create log entry "Voice VLAN Created"
else
  create log entry "No Voice VLAN Created"
endif
if (!$match($ynvvoiceports,yes)) then
  if (!$match($ynvvoicetag,yes)) then
    config vlan $vvoice add ports $vvoiceports tagged
    create log entry "Ports Added To Voice VLAN as Tagged"
  else
    if (!$match($ynvremove,yes)) then
      config vlan $vremove delete port $vvoiceports
      create log entry "Ports removed from VLAN "
    endif
    config vlan $vvoice add ports $vvoiceports untagged
    create log entry "Ports Added To Voice VLAN as Untagged"
  endif
else
  create log entry "No Ports Added To Voice VLAN"
endif
################################################################################
# LLDP Configuration
################################################################################
if (!$match($ynlldp,yes)) then
    enable lldp ports $vvoiceports
    if (!$match($ynlldpavaya,yes)) then
      create log entry "Configuring LLDP parameters."
      configure lldp port $vvoiceports advertise vendor-specific avaya-extreme call-server $lldpavayacall
      configure lldp port $vvoiceports advertise vendor-specific avaya-extreme file-server $lldpavayafile
      configure lldp port $vvoiceports advertise vendor-specific avaya-extreme dot1q-framing tag
    endif
endif

################################################################################
# QoS Configuration
################################################################################
if (!$match($yndiffserv,yes)) then
  create log entry "Configure DSCP to QoS Profiles"
  if (!$match($ynqosqueue,yes)) then
    create log entry "Creating QoS Profiles"
    if (!$match($ynstack,no)) then
      create qosprofile qp7
      config diffserv examination code-point $voicedscp qp7
      create log entry "DSCP value set to Newly Created QP7"
    else
      create qosprofile qp5
      config diffserv examination code-point $voicedscp qp5
      create log entry "DSCP value set to Newly Created QP5"
    endif
  else
    create log entry "Setting DSCP Values to Existing QoS Profile"
    if (!$match($ynstack,no)) then
      config diffserv examination code-point $voicedscp qp7
      create log entry "DSCP value set to QP7"
    else
      config diffserv examination code-point $voicedscp qp5
      create log entry "DSCP value set to QP5"
    endif
  endif
  enable diffserv examination ports all
endif
create log entry "VoIP Overlay scripting.Script Finished On Switch"
disable cli scripting
  </content>
  <creator>system</creator>
  <contexts>,Device,</contexts>
  <supprotedGroups></supprotedGroups>
  <roles>,Administrator,</roles>
  <auditLogEnabled>true</auditLogEnabled>
  <saveConfigOnExit>false</saveConfigOnExit>
  <menuScope>TOOLS</menuScope>
  <scriptTimeout>60</scriptTimeout>
  <defaultCategory>Config</defaultCategory>
</script>
