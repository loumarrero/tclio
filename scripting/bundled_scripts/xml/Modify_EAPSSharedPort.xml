<!-- This file is generated by system. Do not edit this file. -->
<script name="Modify_EAPSSharedPort">
<comments>This script modifies a EAPS Shared-Port</comments>
<content>#@METADATASTART
#@DetailDescriptionStart
########################################################################
# Extreme Networks(R) CLI Scripting Library
# Note          : EAPS Shared-Port Configuration Management
# scripting.Script        : EAPS Shared Port modification
########################################################################
# Revision      : 1.0
# Last Updated  : 12-JAN-2010
########################################################################
# Author Name   : NMS Team
########################################################################
# Purpose:
########################################################################
# 1. Modify EAPS Shared Port
# 2. Enable EAPS configurations globally
#####################################################################
#@DetailDescriptionEnd

# @ScriptDescription &quot;This script modifies EAPS Shared-Port&quot;
# @SectionStart (description = &quot;EAPS Shared-Port Modify Params&quot;)

# @VariableFieldLabel (description = &quot;Abort on error?&quot;,
#   type        = String,
#   scope       = global,
#   required    = yes,
#   validValues = [yes,no])
set var abortOnCliError yes

######################################################################
# EAPS Shared-Port Parameters Definition
######################################################################

# @VariableFieldLabel (description = &quot;Choose Modification Action&quot;,
#   type        = String,
#   scope       = global,
#   required    = yes,
#   validValues = [Modify_Role,Modify_Timers])
set var eapsSPModifyAction Modify_Timers

# @VariableFieldLabel (description = &quot;EAPS Shared Port Number&quot;,
#     type        = String,
#     scope       = device,
#     required    = yes)
set var eapsSPPortNum &quot;&quot;

# @VariableFieldLabel (description = &quot;EAPS Shared Port Mode&quot;,
#     type        = String,
#     scope       = device,
#     required    = yes,
#     validValues = [controller,partner])
set var eapsSPMode controller

# @VariableFieldLabel (description = &quot;Old EAPS Shared Port Mode&quot;,
#     type        = String,
#     scope       = device,
#     required    = yes,
#     validValues = [controller,partner])
set var eapsSPOldMode &quot;&quot;

# @VariableFieldLabel (description = &quot;Common Path Health Interval 1-10 Secs&quot;,
#     type        = String,
#     scope       = global,
#     required    = yes)
set var eapsSPCommonPathInterval 1

# @VariableFieldLabel (description = &quot;Common Path Timeout 3-30 Secs&quot;,
#     type        = String,
#     scope       = global,
#     required    = yes)
set var eapsSPCommonPathTimeout 3

# @VariableFieldLabel (description = &quot;Old Common Path Timeout 3-30 Secs&quot;,
#     type        = String,
#     scope       = global,
#     required    = yes)
set var eapsSPOldCommonPathInterval 3

# @VariableFieldLabel (description = &quot;Segment Port Health Interval 1-10 Secs&quot;,
#     type        = String,
#     scope       = global,
#     required    = yes)
set var eapsSPSegmentInterval 1

# @VariableFieldLabel (description = &quot;Segment Timeout 3-30 Secs&quot;,
#     type        = String,
#     scope       = global,
#     required    = yes)
set var eapsSPSegmentTimeout 3

# @VariableFieldLabel (description = &quot;Old Segment Timeout 3-30 Secs&quot;,
#     type        = String,
#     scope       = global,
#     required    = yes)
set var eapsSPOldSegmentInterval 3

# @VariableFieldLabel (description = &quot;Segment Timeout Expiry Action&quot;,
#     type        = String,
#     scope       = device,
#     required    = yes,
#     validValues = [segment-down,send-alert])
set var eapsSPSegmentExpiryAction segment-down

# @SectionEnd
# @MetaDataEnd

##########################################################################
##########################################################################
# CONFIGURATION DETAIL
##########################################################################

############################################################################
# TCL Procedure for CLI scripting.Script Execution Mode setting
############################################################################
proc setCliErrorHandling {inAbortStatus} {

     global abort_on_error

     if {![string compare $inAbortStatus "yes"]} {
        configure cli mode scripting abort-on-error
     } else {
        configure cli mode scripting ignore-error
     }
}

#####################################################################
# TCL Procedure for EAPS Shared-Port Role Validation
#####################################################################
proc validateEapsSharedPortRole {inPortNum
                                 inMode
                                 inOldMode} {
    global abort_on_error
    global vendor

    IF (![string equal $vendor &quot;Extreme&quot;]) THEN
       error &quot;This script is only supported for Extreme switches.&quot;
    ENDIF

    IF (![expr [string length $inPortNum] &gt; 0]) THEN
       error &quot;FAILED: EAPS Shared-Port Num is empty.&quot;
    ENDIF

    IF (![expr [string length $inMode] &gt; 0]) THEN
       error &quot;FAILED: EAPS Shared-Port Mode is empty.&quot;
    ENDIF

    IF (![expr [string length $inOldMode] &gt; 0]) THEN
       error &quot;FAILED: Old EAPS Shared-Port Mode is empty.&quot;
    ENDIF
}

#####################################################################
# TCL Procedure for EAPS Shared-Port Timers Validation
#####################################################################
proc validateEapsSharedPortTimers {inPortNum
                                   inCommonPathInterval
                                   inCommonPathTimeout
                                   inSegmentInterval
                                   inSegmentTimeout
                                   inSegmentExpiryAction} {
    global abort_on_error
    global vendor

    IF (![string equal $vendor &quot;Extreme&quot;]) THEN
       error &quot;This script is only supported for Extreme switches.&quot;
    ENDIF

    IF (![expr [string length $inPortNum] &gt; 0]) THEN
       error &quot;FAILED: EAPS Shared-Port Num is empty.&quot;
    ENDIF

    IF (![expr [string length $inCommonPathInterval] &gt; 0]) THEN
       error &quot;FAILED: EAPS Common-Path Health Interval is empty.&quot;
    ENDIF

    IF (![expr [string length $inCommonPathTimeout] &gt; 0]) THEN
       error &quot;FAILED: EAPS Common-Path Timeout is empty.&quot;
    ENDIF

    IF (![expr [string length $inSegmentInterval] &gt; 0]) THEN
       error &quot;FAILED: EAPS Segment Health Interval is empty.&quot;
    ENDIF

    IF (![expr [string length $inSegmentTimeout] &gt; 0]) THEN
       error &quot;FAILED: EAPS Segment Timeout is empty.&quot;
    ENDIF

    IF (![expr [string length $inSegmentExpiryAction] &gt; 0]) THEN
       error &quot;FAILED: EAPS Segment Timeout Expiry Action is empty.&quot;
    ENDIF
}

#####################################################################
# TCL Procedure for EAPS Shared-Port Role Modification
#####################################################################
proc modifyEapsSharedPortRole {inPortNum
                               inMode
                               inOldMode} {

    global abort_on_error

    global isExos

    validateEapsSharedPortRole $inPortNum \
                               $inMode \
                               $inOldMode



    if {[string match $isExos true]} {
        configure eaps config-warnings off
    }

    if {[catch {
       configure eaps shared-port $inPortNum mode $inMode
    } errMsgText ]} {
       error &quot;FAILED: Can't set role $inMode on Shared-Port $inPortNum $errMsgText&quot;
    }
}

#####################################################################
# TCL Procedure for EAPS Shared-Port Timers Modification
#####################################################################
proc modifyEapsSharedPortTimers {inPortNum
                                 inCommonPathInterval
                                 inCommonPathTimeout
                                 inOldCommonPathInterval
                                 inSegmentInterval
                                 inSegmentTimeout
                                 inOldSegmentInterval
                                 inSegmentExpiryAction} {
    global abort_on_error

    global isExos

    validateEapsSharedPortTimers $inPortNum \
                                 $inCommonPathInterval \
                                 $inCommonPathTimeout \
                                 $inSegmentInterval \
                                 $inSegmentTimeout \
                                 $inSegmentExpiryAction

    if {[string match $isExos true]} {
        configure eaps config-warnings off
    }

    set var isSharedLinkTimerSupported [isATLPropertySupported EAPS_SHAREDPORT_TIMER_SUPPORT]
    IF ($isSharedLinkTimerSupported) THEN

       if {$inSegmentTimeout &lt; $inOldSegmentInterval} {
            if {[catch {
                   configure eaps shared-port $inPortNum segment-timers health-interval $inSegmentInterval
                } errMsgText ]} {
               error &quot;FAILED: Can't set Segment Health-Interval $inSegmentInterval on Shared-Port $inPortNum $errMsgText&quot;
            }
            if {[catch {
                   configure eaps shared-port $inPortNum segment-timers timeout $inSegmentTimeout
            } errMsgText ]} {
                error &quot;FAILED: Can't set Segment Timeout $inSegmentTimeout on Shared-Port $inPortNum $errMsgText&quot;
            }
       } elseif {$inSegmentTimeout &gt; $inOldSegmentInterval} {
            if {[catch {
                   configure eaps shared-port $inPortNum segment-timers timeout $inSegmentTimeout
            } errMsgText ]} {
                error &quot;FAILED: Can't set Segment Timeout $inSegmentTimeout on Shared-Port $inPortNum $errMsgText&quot;
            }
            if {[catch {
                   configure eaps shared-port $inPortNum segment-timers health-interval $inSegmentInterval
               } errMsgText ]} {
               error &quot;FAILED: Can't set Segment Health-Interval $inSegmentInterval on Shared-Port $inPortNum $errMsgText&quot;
            }
       }
       if {[catch {
           configure eaps shared-port $inPortNum segment-timers expiry-action $inSegmentExpiryAction
       } errMsgText ]} {
           error &quot;FAILED: Can't set Segment Expiry-Action $inSegmentExpiryAction on Shared-Port $inPortNum $errMsgText&quot;
       }
    ELSE
       if {[catch {
           configure eaps shared-port $inPortNum segment-timeout expiry-action $inSegmentExpiryAction
       } errMsgText ]} {
           error &quot;FAILED: Can't set Segment Expiry-Action $inSegmentExpiryAction on Shared-Port $inPortNum $errMsgText&quot;
       }
    ENDIF
}

##################################################################
# TCL Procedure for EAPS Shared-Port Modification
# after validating all parameters
##################################################################
proc handleEapsSharedPortModify {inModifyAction
                                 inPortNum
                                 inMode
                                 inOldMode
                                 inCommonPathInterval
                                 inCommonPathTimeout
                                 inOldCommonPathInterval
                                 inSegmentInterval
                                 inSegmentTimeout
                                 inOldSegmentInterval
                                 inSegmentExpiryAction} {
    global abort_on_error
    global isExos

    if {[string match $isExos true]} {
        create log entry &quot;Starting EAPS Shared-Port Modification on Switch&quot;
    }

    switch $inModifyAction {
       Modify_Role {
       modifyEapsSharedPortRole $inPortNum \
                                $inMode \
                                $inOldMode
       }
       Modify_Timers {
       modifyEapsSharedPortTimers $inPortNum \
                                  $inCommonPathInterval \
                                  $inCommonPathTimeout \
                                  $inOldCommonPathInterval \
                                  $inSegmentInterval \
                                  $inSegmentTimeout \
                                  $inOldSegmentInterval \
                                  $inSegmentExpiryAction
       }
       default {
        error &quot;FAILED: Invalid EAPS Shared-Port Modify Action&quot;
       }
    }

    if {[string match $isExos true]} {
        create log entry &quot;Finished EAPS Shared-Port Modification on Switch&quot;
    }
}

############################################################################
# CLI Configuration Starting on the Switch
############################################################################
setCliErrorHandling $abortOnCliError

handleEapsSharedPortModify $eapsSPModifyAction \
                           $eapsSPPortNum \
                           $eapsSPMode \
                           $eapsSPOldMode \
                           $eapsSPCommonPathInterval \
                           $eapsSPCommonPathTimeout \
                           $eapsSPOldCommonPathInterval \
                           $eapsSPSegmentInterval \
                           $eapsSPSegmentTimeout \
                           $eapsSPOldSegmentInterval \
                           $eapsSPSegmentExpiryAction
</content>
<contexts></contexts>
<supprotedGroups>,ALL,</supprotedGroups>
<roles>,Administrator,</roles>
<auditLogEnabled>false</auditLogEnabled>
<scriptTimeout>120</scriptTimeout>
<defaultCategory>Provisioning</defaultCategory>
<rollbackScript>Rollback_MOD_EAPSSharedPort</rollbackScript>
<postprocessScript>Sync_MOD_EAPSSharedPort</postprocessScript>
<creator>system</creator>
<scriptOwner>system</scriptOwner>

</script>
