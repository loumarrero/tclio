<!-- This file is generated by system. Do not edit this file. -->
<script name="Config_Syslog">
    <comments>Factory script to setup syslog on a device</comments>
    <content># @METADATASTART
#@DetailDescriptionStart
################################################################
# System scripting.Script
#
# scripting.Script        : Basic syslog Setup
# Revision      : 1.0
# Last updated  : 01/12/2016
# Purpose       : Setup Syslog on a device
#
# Summary:
#      1. Add the syslog server IP address
#      2. Configure syslog log (Optional)
#      3. Enable syslog
#
# Default Values:
#      Host IPv4   : EMS Server IP (Defaults to EMS server)
#      Host Port   : 514
#      VR ID       : VR-Default | VR-MGMT (Auto Detected)
#      Facility    : local0
#      Filter Name : DefaultFilter
#      scripting.Severity    : Debug-Data
################################################################
#@DetailDescriptionEnd

# @ScriptDescription &quot;Syslog setup for extreme switches.&quot;
# @SectionStart ( description = &quot;Syslog Setup Basics&quot;)

################################################################################
# Server IP address
################################################################################
# @VariableFieldLabel (description = &quot;Remote syslog server IPv4 address (x.x.x.x:y)&quot;,
#      type        = String,
#      scope       = global,
#      required    = no
#    )
set var hostIP &quot;&quot;

################################################################################
# Server udp port
################################################################################
# @VariableFieldLabel (description = &quot;Remote syslog server port&quot;,
#      type        = String,
#      scope       = global
#    )
set var hostPort 514

################################################################################
#  Facility code
################################################################################
# @VariableFieldLabel (description = &quot; Remote syslog server facility&quot;,
#      type        = String,
#      validValues = [local0,local1,local2,local3,local4,local5,local6,local7]
#      scope       = global,
#      required    = yes
#    )
set var facility local0

################################################################################
#  Syslog filter
################################################################################
# @VariableFieldLabel (description = &quot; Configure a severity threshold for this target&quot;,
#      type        = String,
#      scope       = global,
#      required    = no
#    )
set var filterName DefaultFilter

# @VariableFieldLabel (description = &quot; Configure a severity threshold for this target&quot;,
#      type        = String,
#      validValues = [info,notice,warning,error,critical,debug-data,debug-summary,debug-verbose]
#      scope       = global,
#      required    = no
#    )
set var severity Debug-Data

################################################################################
#  Syslog timestamp
################################################################################
# @VariableFieldLabel (description = &quot; Configure timestamp format&quot;,
#      type        = String,
#      validValues = [hundredths,seconds,none]
#      scope       = global,
#      required    = no
#    )
set var timeFormat seconds

# @VariableFieldLabel (description = &quot; Configure date&quot;,
#      type        = String,
#      validValues = [Mmm-dd,dd-Mmm-yyyy,dd-mm-yyyy,mm/dd/yyyy,yyyy-mm-dd,none]
#      scope       = global,
#      required    = no
#    )
#  Mmm-dd          Date format as specified in RFC 3164 (e.g. Jan 14)
#  dd-Mmm-yyyy     Date format as 14-Jan-2003
#  dd-mm-yyyy      Date format as 14-01-2003
#  mm/dd/yyyy      Date format as 01/14/2003
#  none            Do not display anything
#  yyyy-mm-dd      Date format as 2003-01-14
set var dateFormat Mmm-dd

# @SectionEnd
# @MetaDataEnd

################################################################################
# CLI MODE
################################################################################
IF (![string equal $vendor &quot;Extreme&quot;]) THEN
    error &quot;This script is only supported for Extreme switches.&quot;
ENDIF

## The script will have to handle error messages (if any). This will allow us to
## to continue with the rest of the commands if the server hostIP
## already exists in the syslog config.
configure cli mode scripting ignore-error
cli disable clipaging


proc contains {content line} {
    set splitCont [split $content &quot;\n&quot;] ;#Split the files contents on new line
    foreach ele $splitCont {
        set match [string match *$line* $ele]
        if {$match} {return true}
    }
    return false
}

proc getConfigLog {} {
    CLI show config ems
    return ${CLI.OUT}
}

proc getVR {} {
    global deviceIP

    set vrName &quot;VR-Default&quot;
    CLI show iproute vr &quot;VR-Default&quot;
    if {![contains ${CLI.OUT} $deviceIP]} {
        set vrName &quot;VR-Mgmt&quot;
    }
    return $vrName
}

proc isSyslogConfigured {contents} {
    global hostIP
    global hostPort
    global vrName

    return [contains $contents &quot;configure syslog add $hostIP:$hostPort vr $vrName&quot;]
}

proc isSyslogEnabled {contents} {
    global vrName
    global hostIP
    global hostPort
    global facility

    return [contains $contents &quot;enable log target syslog $hostIP:$hostPort vr $vrName $facility&quot;]
}

## update variable values from the switch
set log [getConfigLog]
set vrName [getVR]

## configure syslog on the switch if necessary
if {[catch {
    if { ![isSyslogConfigured $log]} {
        create log entry &quot;Starting to add syslog server&quot;
        configure syslog add $hostIP:$hostPort vr $vrName $facility
        create log entry &quot;Added syslog server for $hostIP:$hostPort&quot;
    }
} result ]} {
    if {[string first &quot;exists&quot; $result] &lt; 0} {
      error &quot;Error occurred adding syslog server. $result&quot;
    }
}

## now enable syslog
if {[catch {
    if {![isSyslogEnabled $log]} {
        configure log target syslog $hostIP:$hostPort vr $vrName $facility filter $filterName severity $severity
#       net0038711 Changing the timestamp format will cause the hostName to no longer be included. 
#        configure log target syslog $hostIP:$hostPort vr $vrName $facility format timestamp $timeFormat date $dateFormat
        create log entry &quot;Enabling syslog&quot;
        enable log target syslog $hostIP:$hostPort vr $vrName $facility
    }
} result ]} {
    error &quot;Error occurred during syslog configuration. $result&quot;
}


</content>
<creator>system</creator>
<scriptOwner>system</scriptOwner>
<contexts>,Device,</contexts>
<supprotedGroups></supprotedGroups>
<roles>,Administrator,</roles>
<auditLogEnabled>false</auditLogEnabled>
<saveConfigOnExit>false</saveConfigOnExit>
<menuScope>TOOLS</menuScope>
<scriptTimeout>60</scriptTimeout>
<defaultCategory>System</defaultCategory>
</script>